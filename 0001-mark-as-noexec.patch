From 8f9acb7a6215c49297f9cb6c574150e48d8f5b76 Mon Sep 17 00:00:00 2001
From: Christopher Degawa <christopher.degawa@intel.com>
Date: Wed, 17 Feb 2021 13:54:28 -0600
Subject: [PATCH] x64inc: mark as noexec

ports https://github.com/OpenVisualCloud/SVT-HEVC/commit/f8f2a91c53b0223a40add8545c994172a44c6091
and fixes https://gitlab.com/AOMediaCodec/SVT-AV1/-/issues/1690

Signed-off-by: Christopher Degawa <christopher.degawa@intel.com>
---
 Source/Lib/Common/ASM_SSE2/x64inc.asm | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/Source/Lib/Common/ASM_SSE2/x64inc.asm b/Source/Lib/Common/ASM_SSE2/x64inc.asm
index 57baf784..37cfbffc 100644
--- a/Source/Lib/Common/ASM_SSE2/x64inc.asm
+++ b/Source/Lib/Common/ASM_SSE2/x64inc.asm
@@ -368,3 +368,8 @@ bits 64
   %endif
 %endmacro
 %define NEED_EMMS 1
+
+; This is needed for ELF, otherwise the GNU linker assumes the stack is executable by default.
+%if FORMAT_ELF
+    [SECTION .note.GNU-stack noalloc noexec nowrite progbits]
+%endif
-- 
GitLab

